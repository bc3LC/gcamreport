---
title: "Dataset Generation Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Dataset_Generation_Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

To see all possibilities of the `generate_report()` function, look [here](https://bc3lc.github.io/gcamreport/reference/generate_report.html).

<span style="color:white">newline</span>









## Example 1: generate a dataset from a database {#example1}

Assume you have a database called `myDb` in a folder named `dbFolder` and are willing to generate a standardized dataset for several scenarios: `scen1`, `scen2`, and `scen3`. With the `generate_report` function, it will be generated and automatically saved in the same folder where `myDb` is.

1) Load `gcamreport` library.

``` r
library(gcamreport)
```

2) Store the database path and name, the query path, the desired project name, and the considered scenarios in variables. In case you do not specify the scenarios, all the scenarios in the database will be considered for reporting.

``` r
dbpath <- "/path/to/database"
dbname <- "gcamdb_name"
prjname <- "awesomeProj.dat"
scen <- c('scen1', 'scen2', 'scen3')
```

Notice that the extension is included in the project name. Accepted extensions: `.dat` & `.proj`.

**Note**: in case you followed the Docker installation, you should store your database inside the `gcamreport` folder and your root directory is called `/app`. Thus, your database path will be something like `/app/path/to/database`.

3) Generate the dataset until the desired year. In this example, 2050. By default is 2100 and it should be at least 2025.

``` r
generate_report(db_path = dbpath, query_path = querypath, db_name = dbname, 
                prj_name = prjname, scenarios = scen, final_year = 2050, 
                launch_ui = FALSE)
```

**Note**: project generation requires approximately 30 minutes.

Notice that the dataset will automatically be saved in `.RData`, `.csv` and `.xlsx` at `/path/to/database/awesomeProj_standardized.RData`, `/path/to/database/awesomeProj_standardized.csv`, and `/path/to/database/awesomeProj_standardized.xlsx`.
TODO specify reg, continent, variables

This procedure will generate a project file at `/path/to/database/dbname_prjname.dat` with all the necessary queries that you can use as indicated in [Example 2](#example2).

The terminal will output the performed verifications and their final status.

<span style="color:white">newline</span>










## Example 2: generate a dataset from a project {#example2}

Assume you have a project called `myProj.dat` and are willing to generate a standardized dataset out of it. With the `generate_report` function, it will be generated and automatically saved in the same folder where `myProj.dat` is. Notice that `myProj.dat` should have all the required queries for the standardized dataset generation. If you are not sure you have all of them or you need to generate the project, see [Example1](#example1).


1) Load `gcamreport` library.

``` r
library(gcamreport)
```


2) Store the project path and the scenarios in a variable. In case you do not specify the scenarios, all the scenarios in the project will be considered for the reporting.

``` r
mypath <- "/path/to/project/myProj.dat"
scen <- c('scen1', 'scen2', 'scen3')
```

Notice that the extension is included. Accepted extensions: `.dat` & `.proj`.

**Note**: in case you followed the Docker installation, you should store your database inside the `gcamreport` folder and your root directory is called `/app`. Thus, your database path will be something like `/app/path/to/database`.

3) Generate the dataset until the desired year. In this example, 2050. By default is 2100 and it should be at least 2025.

``` r
generate_report(project_path = mypath, scenarios = scen, final_year = 2050, 
                launch_ui = FALSE)
```

Notice that the dataset will automatically be saved in `.RData`, `.csv` and `.xlsx` at `/path/to/project/myProj_standardized.RData`, `/path/to/project/myProj_standardized.csv`, and `/path/to/project/myProj_standardized.xlsx`.

The terminal will output the performed verifications and their final status.


<span style="color:white">newline</span>











## Example 3: save or not the output and specify the file format or the directory

Assume you are in the situation of any of the previous examples but want to either not save the output, save it in `.csv`, `.xlsx`, or both extensions.

1) Load `gcamreport` library.

``` r
library(gcamreport)
```


2) Use [example1](#example1) database or [example2](#example2) project description and add all the extra parameters that you consider in the `generate_report` function. Specify the output saving options through the `save_output` parameter

```r
## -- save the dataset in CSV and XLSX format
generate_report(..., save_output = TRUE)    # this is the default option

## -- save the dataset only in CSV format
generate_report(..., save_output = 'CSV')

## -- save the dataset only in XLSX format
generate_report(..., save_output = 'XLSX')

## -- do not save the dataset
generate_report(..., save_output = FALSE)
```



3) Use [example1](#example1) database or [example2](#example2) project description and add all the extra parameters that you consider in the `generate_report` function. Specify the output directory and output file name through `file_name` parameter. This will save the output in the indicated path as `.csv` and `.xlsx`. To modify this, see the above explanation.

```r
## -- save the dataset in '/desired/directory' and in a file called 'awesomeOutput'
generate_report(..., file_name = '/desired/directory/awesomeOutput')
```
<span style="color:white">newline</span>





## Example 4: specify the regions or regions' group/s

Assume you are in the situation of any of the previous examples but want to consider only some regions. You have two options to select them: you can directly specify the desired regions to consider or you can specify the regions' group/s to consider. In any case, the desired regions will make up *World*. Then, for example, the World's total crop land will be the sum of the crop land of **only** the picked regions. 

1) Load `gcamreport` library.

``` r
library(gcamreport)
```

2) Check which are the available regions or regions' groups. The following commands will print a list with all the possibilities.

``` r
available_regions()
available_continents()
```
In case you want to save them in a vector, you can simply assign the output. You can also skip the regions' console printing by setting `print = FALSE`.

``` r
avail_reg <- available_regions(print = FALSE)
avail_cont <- available_continents()
```


3) Use [example1](#example1) database or [example2](#example2) project description and add all the extra parameters that you consider in the `generate_report` function. Specify the regions through the `desired_regions` parameter or regions' group through the `desired_continents` parameter. Notice that not both can be specified at the same time.

```r
## -- specify the desired regions
generate_report(..., desired_regions = c('EU-15','EU-12'))

## -- specify the desired regions' group/s
generate_report(..., desired_continents = c('ASIA','REF'))
```

<span style="color:white">newline</span>






## Example 5: specify the variables

Assume you are in the situation of any of the previous examples but want to consider only variables. 

1) Load `gcamreport` library.

``` r
library(gcamreport)
```

2) Check which are the available variables. The following command will print a list with all the possibilities.

``` r
available_variables()
```
In case you want to save them in a vector, you can simply assign the output. You can also skip the variables' console printing by setting `print = FALSE`.

``` r
avail_var <- available_variables(print = FALSE)
```


3) Use [example1](#example1) database or [example2](#example2) project description and add all the extra parameters that you consider in the `generate_report` function. Specify the variables through the `desired_variables` parameter. You can specify a vector with all the desired variables names fully written, or also consier all variables that start with the same name. This last feature, allows you to easily select all variables within a group, such as *Emissions*, *Emissions|CO2*, or *Agricultural Demand*

```r
## -- specify the desired variables
generate_report(..., 
              desired_variables = c('Agricultural Demand|Crops|Energy',
                                    'Agricultural Demand|Crops|Feed',
                                    'Capacity Additions|Electricity|Wind|Onshore', 
                                    'Emissions|BC|Energy*')) # This will select,
                                                             # Emissions|BC|Energy,
                                                             # Emissions|BC|Energy|Demand|Industry, 
                                                             # Emissions|BC|Energy|Demand|Residential and Commercial,
                                                             # Emissions|BC|Energy|Demand|Transportation,
                                                             # Emissions|BC|Energy|Supply
```

In case you specify only some variables within a group, they will make up the total value. As an example, if we select *Final Energy|Electricity* and *Final Energy|Gases*, then *Final Energy* will be the sum of these two sectors, and will not consider *Final Energy|Industry* or *Final Energy|Heat*.

<span style="color:white">newline</span>






## Troubleshooting for the `generate_report()` function

#### A) Error on `generate_report("path/to/your/data/myData.dat")`

In your R console, you might see this error:

    > generate_report("path/to/your/data/myData.dat")
    [1] "Loading project..."
    [1] "Loading data, performing checks, and saving output..."
    [1] "ag_demand_clean"
    Error in rgcam::getQuery(prj, "demand balances by crop commodity") :
      getQuery: Query demand balances by crop commodity is not in any scenarios in the data set.

This problem is due to a wrong path specification.

**Possible solution**: make sure that you specified correctly the path. In addition:

-   In case you are using `gcamreport` package following the [R installation](#with-r), try to copy the whole path to your data, for instance `C:\Users\username\Documents\path\to\your\data\myData.dat` if you are using a Windows distribution.

-   In case you are using `gcamreport` package following the [Docker installation](#with-docker):

    a)  make sure that your data is inside the `gcamreport` folder.

    b)  make sure that you type correctly the path to your `gcamreport` folder when generate_reportning the docker image (5th step in the [Docker section](#with-docker))

    c)  make sure that you are pointing correctly to your data. For example, if in the `gcamreport` folder you have a folder called `amazingData` with your dataset `myData.dat`, you should refer to it as

``` r
# option 1: full path
generate_report("/app/amazingData/myData.dat")

# option 2: partial path
generate_report("amazingData/myData.dat")
```
<span style="color:white">newline</span>






#### B) Error related to *system* when using the Docker installation.

Once the R console is opened, you might see this message after introducing any command:

    System has not been booted with systemd as init system (PID 1). Can't operate.
    Failed to connect to bus: Host is down
    Warning message:
    In system("timedatectl", intern = TRUE) :
       running command 'timedatectl' had status 1 

**Possible solution**: simply type `Ctrl+C` and run your command again.
